"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[437],{9437:(e,s,t)=>{t.r(s),t.d(s,{default:()=>h});var r=t(5043),a=t(9722);const n=a.A.create({baseURL:"/api",timeout:8e3});let o=!1,c=[];function i(e){const s=[...c];c=[],s.forEach((s=>{try{s(e)}catch(t){console.error("Queue resolver error:",t)}}))}n.interceptors.request.use((e=>{const s=localStorage.getItem("ts_access_token");s&&(e.headers.Authorization="Bearer ".concat(s));const t=localStorage.getItem("ts_user_id")||"demo-user";return e.headers["X-User-ID"]=t,e}),(e=>Promise.reject(e))),n.interceptors.response.use((e=>e),(async e=>{const{config:s,response:t}=e;if(!t||401!==t.status||s.__retry)return Promise.reject(e);if(console.log("\ud83d\udd04 401 detected, handling token refresh..."),!o){o=!0,console.log("\ud83d\udd04 Starting token refresh process...");try{var r;const e=await a.A.post("/api/auth/tradestation/refresh");if(null!==(r=e.data)&&void 0!==r&&r.ok){var l;console.log("\u2705 Token refresh successful");if(null!==(l=(await a.A.get("/api/auth/tradestation/status")).data)&&void 0!==l&&l.authenticated){const e=localStorage.getItem("ts_access_token");console.log("\u2705 New token available, processing queue..."),i(e||"refreshed")}else console.warn("\u26a0\ufe0f  Refresh succeeded but not authenticated"),i("")}else console.error("\u274c Token refresh failed:",e.data),i("")}catch(d){console.error("\u274c Token refresh error:",d),i("")}finally{o=!1,console.log("\ud83d\udd04 Token refresh process completed")}}return new Promise(((t,r)=>{var a;a=async a=>{if(!a)return console.log("\u274c No token after refresh, rejecting request"),void r(e);console.log("\ud83d\udd04 Retrying original request..."),s.__retry=!0,"refreshed"!==a&&(s.headers.Authorization="Bearer ".concat(a));try{const e=await n(s);console.log("\u2705 Request retry successful"),t(e)}catch(o){console.error("\u274c Request retry failed:",o),r(o)}},c.push(a)}))}));const l=e=>{localStorage.setItem("ts_user_id",e)},d=n;var u=t(579);const h=()=>{const[e,s]=(0,r.useState)(null),[t,a]=(0,r.useState)(!1),[n,o]=(0,r.useState)([]),c=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";const t=(new Date).toLocaleTimeString();o((r=>[...r,{timestamp:t,message:e,type:s}]))},i=async()=>{try{const e=await d.get("/auth/tradestation/status");s(e.data);const{authenticated:t,expires_in:r,status:a}=e.data;c("\ud83d\udcca Status: ".concat(t?"authenticated":"not authenticated",", expires in ").concat(r,"s (").concat(a,")"),"info")}catch(e){c("\u274c Status check error: ".concat(e.message),"error")}};return(0,r.useEffect)((()=>{const e=setInterval(i,2e3);return()=>clearInterval(e)}),[]),(0,u.jsxs)("div",{className:"max-w-4xl mx-auto p-6 bg-gray-900 text-white rounded-lg",children:[(0,u.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"\ud83d\udd27 TradeStation Token Refresh Test"}),(0,u.jsxs)("div",{className:"bg-gray-800 p-4 rounded-lg mb-6",children:[(0,u.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Current Status"}),e?(0,u.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{className:"text-gray-400",children:"Authenticated:"}),(0,u.jsx)("span",{className:"ml-2 ".concat(e.authenticated?"text-green-400":"text-red-400"),children:e.authenticated?"\u2705 Yes":"\u274c No"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{className:"text-gray-400",children:"Expires in:"}),(0,u.jsxs)("span",{className:"ml-2 font-mono ".concat(e.expires_in<=60?"text-yellow-400":"text-green-400"),children:[e.expires_in,"s"]})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{className:"text-gray-400",children:"Status:"}),(0,u.jsx)("span",{className:"ml-2 text-blue-400",children:e.status})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{className:"text-gray-400",children:"Needs refresh:"}),(0,u.jsx)("span",{className:"ml-2 ".concat(e.needs_refresh?"text-yellow-400":"text-green-400"),children:e.needs_refresh?"\u26a0\ufe0f Yes":"\u2705 No"})]})]}):(0,u.jsx)("p",{className:"text-gray-400",children:"No status available"})]}),(0,u.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,u.jsx)("button",{onClick:async()=>{a(!0);try{c("\ud83d\udd27 Initializing test token with 10 second expiry...","info"),l("test-user");(await d.post("/auth/tradestation/init",{access_token:"TEST_ACCESS_TOKEN_"+Date.now(),refresh_token:"TEST_REFRESH_TOKEN_"+Date.now(),expires_in:10})).data.ok?(c("\u2705 Test token initialized successfully","success"),i()):c("\u274c Failed to initialize test token","error")}catch(e){c("\u274c Init error: ".concat(e.message),"error")}finally{a(!1)}},disabled:t,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 rounded-lg transition-colors",children:"\ud83d\udd27 Init Token"}),(0,u.jsx)("button",{onClick:i,disabled:t,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 rounded-lg transition-colors",children:"\ud83d\udcca Check Status"}),(0,u.jsx)("button",{onClick:async()=>{a(!0);try{c("\ud83d\udd04 Testing manual token refresh...","info");(await d.post("/auth/tradestation/refresh")).data.ok?(c("\u2705 Token refresh successful","success"),i()):c("\u274c Token refresh failed","error")}catch(e){c("\u274c Refresh error: ".concat(e.message),"error")}finally{a(!1)}},disabled:t,className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-600 rounded-lg transition-colors",children:"\ud83d\udd04 Force Refresh"}),(0,u.jsx)("button",{onClick:async()=>{a(!0);try{c("\ud83d\ude80 Testing 5 concurrent requests (should trigger single refresh)...","info");const e=Array(5).fill().map(((e,s)=>d.get("/auth/tradestation/status").then((()=>"Request ".concat(s+1," success"))))),s=(await Promise.allSettled(e)).filter((e=>"fulfilled"===e.status)).length;c("\u2705 Concurrent test: ".concat(s,"/5 requests successful"),"success")}catch(e){c("\u274c Concurrent test error: ".concat(e.message),"error")}finally{a(!1)}},disabled:t,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 rounded-lg transition-colors",children:"\ud83d\ude80 Concurrent Test"})]}),(0,u.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,u.jsx)("button",{onClick:async()=>{a(!0);try{c("\ud83d\udd0d Testing token validation (auto-refresh if needed)...","info");const e=await d.get("/auth/tradestation/validate");e.data.valid?c("\u2705 Token validation: ".concat(e.data.message),"success"):c("\u274c Token validation failed: ".concat(e.data.error),"error")}catch(e){c("\u274c Validation error: ".concat(e.message),"error")}finally{a(!1)}},disabled:t,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 rounded-lg transition-colors",children:"\ud83d\udd0d Test Validation"}),(0,u.jsx)("button",{onClick:()=>o([]),className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:"\ud83d\uddd1\ufe0f Clear Logs"})]}),t&&(0,u.jsx)("div",{className:"text-center mb-4",children:(0,u.jsxs)("div",{className:"inline-flex items-center",children:[(0,u.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]})}),(0,u.jsxs)("div",{className:"bg-black rounded-lg p-4 h-64 overflow-y-auto font-mono text-sm",children:[(0,u.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,u.jsx)("h3",{className:"text-green-400",children:"Console Logs"}),(0,u.jsxs)("span",{className:"text-gray-500",children:[n.length," entries"]})]}),(0,u.jsxs)("div",{className:"space-y-1",children:[n.map(((e,s)=>(0,u.jsxs)("div",{className:"\n              ".concat("error"===e.type?"text-red-400":"success"===e.type?"text-green-400":"text-gray-300","\n            "),children:[(0,u.jsxs)("span",{className:"text-gray-500",children:["[",e.timestamp,"]"]})," ",e.message]},s))),0===n.length&&(0,u.jsx)("p",{className:"text-gray-500",children:"No logs yet. Start a test to see activity."})]})]})]})}}}]);
//# sourceMappingURL=437.0568806c.chunk.js.map